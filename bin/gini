#!/usr/bin/env php
<?php

require __DIR__ . '/gini-bootstrap.php';

class Application {

	static function setup() {
		\Model\Cache::setup();
		\Model\Config::setup();
		\Model\Event::setup();
		\Model\I18N::setup();
		\Model\Logger::setup();
		\Model\Session::setup();
		\Model\CLI::setup();

		if (APP_SHORTNAME != 'system') {
			$class = '\\'.str_replace('-', '_', APP_SHORTNAME);
			!method_exists($class, 'setup') or call_user_func($class.'::setup');
		}

	}

	static function main(&$argv) {			
		// $argv包括了我们的cli标准脚本, 因此需要删除
		array_shift($argv);
		\Model\CLI::main($argv);
	}

	static function shutdown() {
		if (APP_SHORTNAME != 'system') {
			$class = '\\'.str_replace('-', '_', APP_SHORTNAME);
			!method_exists($class, 'shutdown') or call_user_func($class.'::shutdown');
		}
		\Model\CLI::shutdown();
		\Model\Session::shutdown();		
	}

	static function exception($e) {
		\Model\CLI::exception($e);
		if (APP_SHORTNAME != 'system') {
			$class = '\\'.str_replace('-', '_', APP_SHORTNAME);
			!method_exists($class, 'exception') or call_user_func($class.'::exception', $e);
		}
	}

}
